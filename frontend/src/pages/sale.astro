---
import Container from "@/components/container.astro";
import Sectionhead from "@/components/sectionhead.astro";
import Layout from "@/layouts/Layout.astro";

type Property = {
  id: number | string;
  title: string;
  location: string;
  price: number;
  imageUrl: string;
  publishDate: string;
};

const backendUrl = "http://localhost:8081";

const response = await fetch("http://localhost:8081/api/properties/sale");
let properties: Property[] = [];

if (response.ok) {
  try {
    properties = await response.json();
  } catch (err) {
    console.error("Error parsing JSON:", err);
  }
} else {
  console.error("Backend response error:", response.status);
}
---

<Layout title="Properties for Sale">
  <Container>
    <Sectionhead>
      <Fragment slot="title">Properties for Sale</Fragment>
      <Fragment slot="desc">
        Discover our handpicked selection of beautiful homes across Mallorca.
      </Fragment>
    </Sectionhead>

    <main class="mt-16">
     <ul class="grid gap-16 max-w-4xl mx-auto">
  {properties.map((property) => (
    <li>
      <a
        href={`/${property.id}`}
        target="_self"
        rel="noopener noreferrer"
        class="block hover:shadow-lg rounded-md transition-shadow"
      >
        <div class="grid md:grid-cols-2 gap-5 md:gap-10 items-center">
          <img
            src={`${backendUrl}${property.imageUrl}`}
            alt={property.title}
            class="w-full rounded-md object-cover object-center bg-white"
          />
          <div>
            <span class="text-blue-400 uppercase tracking-wider text-sm font-medium">
              {property.location}
            </span>
            <h2 class="text-3xl font-semibold leading-snug tracking-tight mt-1">
              {property.title}
            </h2>
            <p class="text-lg text-slate-600 mt-2 font-medium">
              â‚¬ {property.price.toLocaleString()}
            </p>
            <time class="text-gray-400 block mt-2 text-sm">
              Listed on {new Date(property.publishDate).toLocaleDateString()}
            </time>
          </div>
        </div>
      </a>
    </li>
  ))}
</ul>

    </main>
  </Container>
</Layout>
